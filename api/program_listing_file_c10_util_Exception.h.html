


<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Program Listing for File Exception.h &mdash; PyTorch master documentation</title>
  

  
  
  
  
    <link rel="canonical" href="https://pytorch.org/docs/stable/api/program_listing_file_c10_util_Exception.h.html"/>
  

  

  
  
    

  

  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <!-- <link rel="stylesheet" href="../_static/pygments.css" type="text/css" /> -->
  <link rel="stylesheet" href="../_static/cpp_theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/collapsible-lists/css/tree_view.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
  <!-- Google Analytics -->
  
  <!-- End Google Analytics -->
  

  
  <script src="../_static/js/modernizr.min.js"></script>

  <!-- Preload the theme fonts -->

<link rel="preload" href="../_static/fonts/FreightSans/freight-sans-book.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="../_static/fonts/FreightSans/freight-sans-medium.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="../_static/fonts/IBMPlexMono/IBMPlexMono-Medium.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="../_static/fonts/FreightSans/freight-sans-bold.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="../_static/fonts/FreightSans/freight-sans-medium-italic.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="../_static/fonts/IBMPlexMono/IBMPlexMono-SemiBold.woff2" as="font" type="font/woff2" crossorigin="anonymous">

<!-- Preload the katex fonts -->

<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Math-Italic.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Main-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Main-Bold.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Size1-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Size4-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Size2-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Size3-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Caligraphic-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.2/css/all.css" integrity="sha384-vSIIfh2YWi9wW0r9iZe7RJPrKwp6bG+s9QZMoITbCckVJqGCCRhc+ccxNcdpHuYu" crossorigin="anonymous">
</head>

<div class="container-fluid header-holder tutorials-header" id="header-holder">
  <div class="container">
    <div class="header-container">
      <a class="header-logo" href="https://pytorch.org/" aria-label="PyTorch"></a>

      <div class="main-menu">
        <ul>
          <li>
            <a href="https://pytorch.org/get-started">Get Started</a>
          </li>

          <li>
            <a href="https://pytorch.org/ecosystem">Ecosystem</a>
          </li>

          <li>
            <a href="https://pytorch.org/mobile">Mobile</a>
          </li>

          <li>
            <a href="https://pytorch.org/blog/">Blog</a>
          </li>

          <li>
            <a href="https://pytorch.org/tutorials">Tutorials</a>
          </li>

          <li class="active docs-active">
            <div id="resourcesDropdownButton" data-toggle="resources-dropdown" class="resources-dropdown">
              <a class="resource-option with-down-orange-arrow">
                Docs
              </a>
              <div class="resources-dropdown-menu">
                <a class="doc-dropdown-option nav-dropdown-item" href="https://pytorch.org/docs/stable/index.html">
                  <span class="dropdown-title">PyTorch</span>
                  <p></p>
                </a>
                <a class="doc-dropdown-option nav-dropdown-item" href="https://pytorch.org/audio/stable/index.html">
                  <span class="dropdown-title">torchaudio</span>
                  <p></p>
                </a>
                <a class="doc-dropdown-option nav-dropdown-item" href="https://pytorch.org/text/stable/index.html">
                  <span class="dropdown-title">torchtext</span>
                  <p></p>
                </a>
                <a class="doc-dropdown-option nav-dropdown-item" href="https://pytorch.org/vision/stable/index.html">
                  <span class="dropdown-title">torchvision</span>
                  <p></p>
                </a>
                <a class="doc-dropdown-option nav-dropdown-item" href="https://pytorch.org/torcharrow">
                  <span class="dropdown-title">torcharrow</span>
                  <p></p>
                </a>
                <a class="doc-dropdown-option nav-dropdown-item" href="https://pytorch.org/data">
                  <span class="dropdown-title">TorchData</span>
                  <p></p>
                </a>
                <a class="doc-dropdown-option nav-dropdown-item" href="https://pytorch.org/torchrec">
                  <span class="dropdown-title">TorchRec</span>
                  <p></p>
                </a>
                <a class="doc-dropdown-option nav-dropdown-item" href="https://pytorch.org/serve/">
                  <span class="dropdown-title">TorchServe</span>
                  <p></p>
                </a>
                <a class="doc-dropdown-option nav-dropdown-item" href="https://pytorch.org/torchx/">
                  <span class="dropdown-title">TorchX</span>
                  <p></p>
                </a>
                <a class="doc-dropdown-option nav-dropdown-item" href="https://pytorch.org/xla">
                  <span class="dropdown-title">PyTorch on XLA Devices</span>
                  <p></p>
                </a>
            </div>
          </li>

          <li>
            <div id="resourcesDropdownButton" data-toggle="resources-dropdown" class="resources-dropdown">
              <a class="resource-option with-down-arrow">
                Resources
              </a>
              <div class="resources-dropdown-menu">
                <a class="nav-dropdown-item" href="https://pytorch.org/features">
                  <span class="dropdown-title">About</span>
                  <p>Learn about PyTorchâ€™s features and capabilities</p>
                </a>
                <a class="nav-dropdown-item" href="https://pytorch.org/foundation">
                  <span class="dropdown-title">PyTorch Foundation</span>
                  <p>Learn about the PyTorch foundation</p>
                </a>
                <a class="nav-dropdown-item" href="https://pytorch.org/#community-module">
                  <span class="dropdown-title">Community</span>
                  <p>Join the PyTorch developer community to contribute, learn, and get your questions answered.</p>
                </a>
                <a class="nav-dropdown-item" href="https://pytorch.org/community-stories">
                  <span class="dropdown-title">Community Stories</span>
                  <p>Learn how our community solves real, everyday machine learning problems with PyTorch.</p>
                </a>
                <a class="nav-dropdown-item" href="https://pytorch.org/resources">
                  <span class="dropdown-title">Developer Resources</span>
                  <p>Find resources and get questions answered</p>
                </a>
                <a class="nav-dropdown-item" href="https://pytorch.org/events">
                  <span class="dropdown-title">Events</span>
                  <p>Find events, webinars, and podcasts</p>
                </a>
                <a class="nav-dropdown-item" href="https://discuss.pytorch.org/" target="_blank">
                  <span class="dropdown-title">Forums</span>
                  <p>A place to discuss PyTorch code, issues, install, research</p>
                </a>
                <a class="nav-dropdown-item" href="https://pytorch.org/hub">
                  <span class="dropdown-title">Models (Beta)</span>
                  <p>Discover, publish, and reuse pre-trained models</p>
                </a>
              </div>
            </div>
          </li>

          <li>
            <a href="https://github.com/pytorch/pytorch">GitHub</a>
          </li>
        </ul>
      </div>

      <a class="main-menu-open-button" href="#" data-behavior="open-mobile-menu"></a>
    </div>
  </div>
</div>

<body class="pytorch-body">

   

    

    <div class="table-of-contents-link-wrapper">
      <span>Table of Contents</span>
      <a href="#" class="toggle-table-of-contents" data-behavior="toggle-table-of-contents"></a>
    </div>

    <nav data-toggle="wy-nav-shift" class="pytorch-left-menu" id="pytorch-left-menu">
      <div class="pytorch-side-scroll">
        <div class="pytorch-menu pytorch-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          <div class="pytorch-left-menu-search">
            

            
              
              
                <div class="version">
                  master
                </div>
              
            

            


  


<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search Docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

            
          </div>

          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../installing.html">Installing C++ Distributions of PyTorch</a></li>
<li class="toctree-l1"><a class="reference internal" href="../frontend.html">The C++ Frontend</a></li>
<li class="toctree-l1"><a class="reference internal" href="library_root.html">Library API</a></li>
</ul>
<p class="caption"><span class="caption-text">Notes</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../notes/faq.html">FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../notes/inference_mode.html">Inference Mode</a></li>
<li class="toctree-l1"><a class="reference internal" href="../notes/maybe_owned.html">MaybeOwned&lt;Tensor&gt;</a></li>
<li class="toctree-l1"><a class="reference internal" href="../notes/tensor_basics.html">Tensor Basics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../notes/tensor_creation.html">Tensor Creation API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../notes/tensor_cuda_stream.html">Tensor CUDA Stream API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../notes/tensor_indexing.html">Tensor Indexing API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../notes/versioning.html">Library Versioning</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <div class="pytorch-container">
      <div class="pytorch-page-level-bar" id="pytorch-page-level-bar">
        <div class="pytorch-breadcrumbs-wrapper">
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="pytorch-breadcrumbs">
    
      <li>
        <a href="../index.html">
          
            Docs
          
        </a> &gt;
      </li>

        
      <li>Program Listing for File Exception.h</li>
    
    
      <li class="pytorch-breadcrumbs-aside">
        
            
            
              <!-- User defined GitHub URL -->
              <a href="https://github.com/pytorch/pytorch" class="fa fa-github"> Edit on GitHub</a>
            
          
        
      </li>
    
  </ul>

  
</div>
        </div>

        <div class="pytorch-shortcuts-wrapper" id="pytorch-shortcuts-wrapper">
          Shortcuts
        </div>
      </div>

      <section data-toggle="wy-nav-shift" id="pytorch-content-wrap" class="pytorch-content-wrap">
        <div class="pytorch-content-left">

        
          
          <div class="rst-content">
          
            <div role="main" class="main-content" itemscope="itemscope" itemtype="http://schema.org/Article">
             <article itemprop="articleBody" id="pytorch-article" class="pytorch-article">
              
  <div class="section" id="program-listing-for-file-exception-h">
<span id="program-listing-file-c10-util-exception-h"></span><h1>Program Listing for File Exception.h<a class="headerlink" href="#program-listing-for-file-exception-h" title="Permalink to this headline">Â¶</a></h1>
<p>â†° <a class="reference internal" href="file_c10_util_Exception.h.html#file-c10-util-exception-h"><span class="std std-ref">Return to documentation for file</span></a> (<code class="docutils literal notranslate"><span class="pre">c10/util/Exception.h</span></code>)</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#ifndef C10_UTIL_EXCEPTION_H_</span>
<span class="cp">#define C10_UTIL_EXCEPTION_H_</span>

<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;c10/macros/Macros.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;c10/util/Deprecated.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;c10/util/StringUtil.h&gt;</span><span class="cp"></span>

<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;cstddef&gt;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;exception&gt;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;ostream&gt;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;sstream&gt;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;string&gt;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;vector&gt;</span><span class="cp"></span>

<span class="cp">#if defined(_MSC_VER) &amp;&amp; _MSC_VER &lt;= 1900</span>
<span class="cp">#define __func__ __FUNCTION__</span>
<span class="cp">#endif</span>

<span class="k">namespace</span><span class="w"> </span><span class="nn">c10</span><span class="w"> </span><span class="p">{</span><span class="w"></span>

<span class="k">class</span><span class="w"> </span><span class="nc">C10_API</span><span class="w"> </span><span class="n">Error</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">exception</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="c1">// The actual error message.</span>
<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">msg_</span><span class="p">;</span><span class="w"></span>

<span class="w">  </span><span class="c1">// Context for the message (in order of decreasing specificity).  Context will</span>
<span class="w">  </span><span class="c1">// be automatically formatted appropriately, so it is not necessary to add</span>
<span class="w">  </span><span class="c1">// extra leading/trailing newlines to strings inside this vector</span>
<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="w"> </span><span class="n">context_</span><span class="p">;</span><span class="w"></span>

<span class="w">  </span><span class="c1">// The C++ backtrace at the point when this exception was raised.  This</span>
<span class="w">  </span><span class="c1">// may be empty if there is no valid backtrace.  (We don&#39;t use optional</span>
<span class="w">  </span><span class="c1">// here to reduce the dependencies this file has.)</span>
<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">backtrace_</span><span class="p">;</span><span class="w"></span>

<span class="w">  </span><span class="c1">// These two are derived fields from msg_stack_ and backtrace_, but we need</span>
<span class="w">  </span><span class="c1">// fields for the strings so that we can return a const char* (as the</span>
<span class="w">  </span><span class="c1">// signature of std::exception requires).  Currently, the invariant</span>
<span class="w">  </span><span class="c1">// is that these fields are ALWAYS populated consistently with respect</span>
<span class="w">  </span><span class="c1">// to msg_stack_ and backtrace_.</span>
<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">what_</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">what_without_backtrace_</span><span class="p">;</span><span class="w"></span>

<span class="w">  </span><span class="c1">// This is a little debugging trick: you can stash a relevant pointer</span>
<span class="w">  </span><span class="c1">// in caller, and then when you catch the exception, you can compare</span>
<span class="w">  </span><span class="c1">// against pointers you have on hand to get more information about</span>
<span class="w">  </span><span class="c1">// where the exception came from.  In Caffe2, this is used to figure</span>
<span class="w">  </span><span class="c1">// out which operator raised an exception.</span>
<span class="w">  </span><span class="k">const</span><span class="w"> </span><span class="kt">void</span><span class="o">*</span><span class="w"> </span><span class="n">caller_</span><span class="p">;</span><span class="w"></span>

<span class="w"> </span><span class="k">public</span><span class="o">:</span><span class="w"></span>
<span class="w">  </span><span class="c1">// PyTorch-style Error constructor.  NB: the implementation of this</span>
<span class="w">  </span><span class="c1">// is actually in Logging.cpp</span>
<span class="w">  </span><span class="n">Error</span><span class="p">(</span><span class="n">SourceLocation</span><span class="w"> </span><span class="n">source_location</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">msg</span><span class="p">);</span><span class="w"></span>

<span class="w">  </span><span class="c1">// Caffe2-style error message</span>
<span class="w">  </span><span class="n">Error</span><span class="p">(</span><span class="w"></span>
<span class="w">      </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">file</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="k">const</span><span class="w"> </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">line</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">condition</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">msg</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">backtrace</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="k">const</span><span class="w"> </span><span class="kt">void</span><span class="o">*</span><span class="w"> </span><span class="n">caller</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">);</span><span class="w"></span>

<span class="w">  </span><span class="c1">// Base constructor</span>
<span class="w">  </span><span class="n">Error</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">msg</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">backtrace</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">void</span><span class="o">*</span><span class="w"> </span><span class="n">caller</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">);</span><span class="w"></span>

<span class="w">  </span><span class="c1">// Add some new context to the message stack.  The last added context</span>
<span class="w">  </span><span class="c1">// will be formatted at the end of the context list upon printing.</span>
<span class="w">  </span><span class="c1">// WARNING: This method is O(n) in the size of the stack, so don&#39;t go</span>
<span class="w">  </span><span class="c1">// wild adding a ridiculous amount of context to error messages.</span>
<span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="nf">add_context</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">msg</span><span class="p">);</span><span class="w"></span>

<span class="w">  </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="nf">msg</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">msg_</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>

<span class="w">  </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;&amp;</span><span class="w"> </span><span class="n">context</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">context_</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>

<span class="w">  </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">backtrace</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">backtrace_</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>

<span class="w">  </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">what</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">noexcept</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">what_</span><span class="p">.</span><span class="n">c_str</span><span class="p">();</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>

<span class="w">  </span><span class="k">const</span><span class="w"> </span><span class="kt">void</span><span class="o">*</span><span class="w"> </span><span class="n">caller</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">noexcept</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">caller_</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>

<span class="w">  </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">what_without_backtrace</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">noexcept</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">what_without_backtrace_</span><span class="p">.</span><span class="n">c_str</span><span class="p">();</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>

<span class="w"> </span><span class="k">private</span><span class="o">:</span><span class="w"></span>
<span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="n">refresh_what</span><span class="p">();</span><span class="w"></span>
<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="nf">compute_what</span><span class="p">(</span><span class="kt">bool</span><span class="w"> </span><span class="n">include_backtrace</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="p">;</span><span class="w"></span>
<span class="p">};</span><span class="w"></span>

<span class="k">class</span><span class="w"> </span><span class="nc">C10_API</span><span class="w"> </span><span class="n">WarningHandler</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w"> </span><span class="k">public</span><span class="o">:</span><span class="w"></span>
<span class="w">  </span><span class="k">virtual</span><span class="w"> </span><span class="o">~</span><span class="n">WarningHandler</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">default</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">process</span><span class="p">(</span><span class="w"></span>
<span class="w">      </span><span class="k">const</span><span class="w"> </span><span class="n">SourceLocation</span><span class="o">&amp;</span><span class="w"> </span><span class="n">source_location</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">msg</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="k">const</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">verbatim</span><span class="p">);</span><span class="w"></span>
<span class="p">};</span><span class="w"></span>

<span class="k">namespace</span><span class="w"> </span><span class="nn">Warning</span><span class="w"> </span><span class="p">{</span><span class="w"></span>

<span class="c1">// Note: [Verbatim Warnings]</span>
<span class="c1">// Warnings originating in C++ code can appear out-of-place to Python users:</span>
<span class="c1">// a user runs a line in Python, but the warning references a line in C++.</span>
<span class="c1">// Some parts of PyTorch, like the JIT, are cognizant of this mismatch</span>
<span class="c1">// and take care to map warnings back to the user&#39;s program, but most</span>
<span class="c1">// of PyTorch simply throws a context-free warning. To allow warning</span>
<span class="c1">// handlers to add context where appropriate, warn takes the</span>
<span class="c1">// &quot;verbatim&quot; flag. When this is false a warning handler might append</span>
<span class="c1">// the C++ warning to a Python warning message that relates the warning</span>
<span class="c1">// back to the user&#39;s program. Callers who have already accounted for</span>
<span class="c1">// context in their warnings should set verbatim to true so their warnings</span>
<span class="c1">// appear without modification.</span>

<span class="n">C10_API</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="n">warn</span><span class="p">(</span><span class="w"></span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">SourceLocation</span><span class="o">&amp;</span><span class="w"> </span><span class="n">source_location</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">msg</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="n">verbatim</span><span class="p">);</span><span class="w"></span>
<span class="n">C10_API</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="n">warn</span><span class="p">(</span><span class="w"></span>
<span class="w">    </span><span class="n">SourceLocation</span><span class="w"> </span><span class="n">source_location</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">msg</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="n">verbatim</span><span class="p">);</span><span class="w"></span>
<span class="n">C10_API</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="n">warn</span><span class="p">(</span><span class="w"></span>
<span class="w">    </span><span class="n">SourceLocation</span><span class="w"> </span><span class="n">source_location</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="o">::</span><span class="n">c10</span><span class="o">::</span><span class="n">detail</span><span class="o">::</span><span class="n">CompileTimeEmptyString</span><span class="w"> </span><span class="n">msg</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="n">verbatim</span><span class="p">);</span><span class="w"></span>
<span class="n">C10_API</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="n">set_warning_handler</span><span class="p">(</span><span class="n">WarningHandler</span><span class="o">*</span><span class="w"> </span><span class="n">handler</span><span class="p">)</span><span class="w"> </span><span class="k">noexcept</span><span class="p">(</span><span class="nb">true</span><span class="p">);</span><span class="w"></span>
<span class="n">C10_API</span><span class="w"> </span><span class="n">WarningHandler</span><span class="o">*</span><span class="w"> </span><span class="n">get_warning_handler</span><span class="p">()</span><span class="w"> </span><span class="k">noexcept</span><span class="p">(</span><span class="nb">true</span><span class="p">);</span><span class="w"></span>

<span class="k">class</span><span class="w"> </span><span class="nc">C10_API</span><span class="w"> </span><span class="n">WarningHandlerGuard</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="n">WarningHandler</span><span class="o">*</span><span class="w"> </span><span class="n">prev_handler_</span><span class="p">;</span><span class="w"></span>

<span class="w"> </span><span class="k">public</span><span class="o">:</span><span class="w"></span>
<span class="w">  </span><span class="n">WarningHandlerGuard</span><span class="p">(</span><span class="n">WarningHandler</span><span class="o">*</span><span class="w"> </span><span class="n">new_handler</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="o">:</span><span class="w"> </span><span class="n">prev_handler_</span><span class="p">(</span><span class="n">c10</span><span class="o">::</span><span class="n">Warning</span><span class="o">::</span><span class="n">get_warning_handler</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">c10</span><span class="o">::</span><span class="n">Warning</span><span class="o">::</span><span class="n">set_warning_handler</span><span class="p">(</span><span class="n">new_handler</span><span class="p">);</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="w">  </span><span class="o">~</span><span class="n">WarningHandlerGuard</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">c10</span><span class="o">::</span><span class="n">Warning</span><span class="o">::</span><span class="n">set_warning_handler</span><span class="p">(</span><span class="n">prev_handler_</span><span class="p">);</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">};</span><span class="w"></span>

<span class="n">C10_API</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="n">set_warnAlways</span><span class="p">(</span><span class="kt">bool</span><span class="p">)</span><span class="w"> </span><span class="k">noexcept</span><span class="p">(</span><span class="nb">true</span><span class="p">);</span><span class="w"></span>
<span class="n">C10_API</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">get_warnAlways</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="w"> </span><span class="k">noexcept</span><span class="p">(</span><span class="nb">true</span><span class="p">);</span><span class="w"></span>

<span class="c1">// A RAII guard that sets warn_always (not thread-local) on</span>
<span class="c1">// construction, and sets it back to the original value upon destruction.</span>
<span class="k">struct</span><span class="w"> </span><span class="nc">C10_API</span><span class="w"> </span><span class="n">WarnAlways</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w"> </span><span class="k">public</span><span class="o">:</span><span class="w"></span>
<span class="w">  </span><span class="k">explicit</span><span class="w"> </span><span class="n">WarnAlways</span><span class="p">(</span><span class="kt">bool</span><span class="w"> </span><span class="n">setting</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">);</span><span class="w"></span>
<span class="w">  </span><span class="o">~</span><span class="n">WarnAlways</span><span class="p">();</span><span class="w"></span>

<span class="w"> </span><span class="k">private</span><span class="o">:</span><span class="w"></span>
<span class="w">  </span><span class="kt">bool</span><span class="w"> </span><span class="n">prev_setting</span><span class="p">;</span><span class="w"></span>
<span class="p">};</span><span class="w"></span>

<span class="p">}</span><span class="w"> </span><span class="c1">// namespace Warning</span>

<span class="c1">// Used in ATen for out-of-bound indices that can reasonably only be detected</span>
<span class="c1">// lazily inside a kernel (See: advanced indexing).  These turn into</span>
<span class="c1">// IndexError when they cross to Python.</span>
<span class="k">class</span><span class="w"> </span><span class="nc">C10_API</span><span class="w"> </span><span class="n">IndexError</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">Error</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="k">using</span><span class="w"> </span><span class="n">Error</span><span class="o">::</span><span class="n">Error</span><span class="p">;</span><span class="w"></span>
<span class="p">};</span><span class="w"></span>

<span class="c1">// Used in ATen for invalid values.  These turn into</span>
<span class="c1">// ValueError when they cross to Python.</span>
<span class="k">class</span><span class="w"> </span><span class="nc">C10_API</span><span class="w"> </span><span class="n">ValueError</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">Error</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="k">using</span><span class="w"> </span><span class="n">Error</span><span class="o">::</span><span class="n">Error</span><span class="p">;</span><span class="w"></span>
<span class="p">};</span><span class="w"></span>

<span class="c1">// Used in ATen for invalid types.  These turn into</span>
<span class="c1">// TypeError when they cross to Python.</span>
<span class="k">class</span><span class="w"> </span><span class="nc">C10_API</span><span class="w"> </span><span class="n">TypeError</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">Error</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="k">using</span><span class="w"> </span><span class="n">Error</span><span class="o">::</span><span class="n">Error</span><span class="p">;</span><span class="w"></span>
<span class="p">};</span><span class="w"></span>

<span class="c1">// Used in ATen for functionality that is not implemented.  These turn into</span>
<span class="c1">// NotImplementedError when they cross to Python.</span>
<span class="k">class</span><span class="w"> </span><span class="nc">C10_API</span><span class="w"> </span><span class="n">NotImplementedError</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">Error</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="k">using</span><span class="w"> </span><span class="n">Error</span><span class="o">::</span><span class="n">Error</span><span class="p">;</span><span class="w"></span>
<span class="p">};</span><span class="w"></span>

<span class="c1">// Used in ATen for non finite indices.  These turn into</span>
<span class="c1">// ExitException when they cross to Python.</span>
<span class="k">class</span><span class="w"> </span><span class="nc">C10_API</span><span class="w"> </span><span class="n">EnforceFiniteError</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">Error</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="k">using</span><span class="w"> </span><span class="n">Error</span><span class="o">::</span><span class="n">Error</span><span class="p">;</span><span class="w"></span>
<span class="p">};</span><span class="w"></span>

<span class="c1">// Used in Onnxifi backend lowering.  These turn into</span>
<span class="c1">// ExitException when they cross to Python.</span>
<span class="k">class</span><span class="w"> </span><span class="nc">C10_API</span><span class="w"> </span><span class="n">OnnxfiBackendSystemError</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">Error</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="k">using</span><span class="w"> </span><span class="n">Error</span><span class="o">::</span><span class="n">Error</span><span class="p">;</span><span class="w"></span>
<span class="p">};</span><span class="w"></span>

<span class="c1">// Used for numerical errors from the linalg module. These</span>
<span class="c1">// turn into LinAlgError when they cross into Python.</span>
<span class="k">class</span><span class="w"> </span><span class="nc">C10_API</span><span class="w"> </span><span class="n">LinAlgError</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">Error</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="k">using</span><span class="w"> </span><span class="n">Error</span><span class="o">::</span><span class="n">Error</span><span class="p">;</span><span class="w"></span>
<span class="p">};</span><span class="w"></span>

<span class="k">class</span><span class="w"> </span><span class="nc">C10_API</span><span class="w"> </span><span class="n">OutOfMemoryError</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">Error</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="k">using</span><span class="w"> </span><span class="n">Error</span><span class="o">::</span><span class="n">Error</span><span class="p">;</span><span class="w"></span>
<span class="p">};</span><span class="w"></span>

<span class="c1">// A utility function to return an exception std::string by prepending its</span>
<span class="c1">// exception type before its what() content</span>
<span class="n">C10_API</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">GetExceptionString</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">exception</span><span class="o">&amp;</span><span class="w"> </span><span class="n">e</span><span class="p">);</span><span class="w"></span>

<span class="p">}</span><span class="w"> </span><span class="c1">// namespace c10</span>

<span class="c1">// Private helper macro for implementing TORCH_INTERNAL_ASSERT and TORCH_CHECK</span>
<span class="c1">//</span>
<span class="c1">// Note: In the debug build With MSVC, __LINE__ might be of long type (a.k.a</span>
<span class="c1">// int32_t), which is different from the definition of `SourceLocation` that</span>
<span class="c1">// requires unsigned int (a.k.a uint32_t) and may cause a compile error with the</span>
<span class="c1">// message: error C2397: conversion from &#39;long&#39; to &#39;uint32_t&#39; requires a</span>
<span class="c1">// narrowing conversion Here the static cast is used to pass the build. if this</span>
<span class="c1">// is used inside a lambda the __func__ macro expands to operator(), which isn&#39;t</span>
<span class="c1">// very useful, but hard to fix in a macro so suppressing the warning.</span>
<span class="cp">#define C10_THROW_ERROR(err_type, msg) \</span>
<span class="cp">  throw ::c10::err_type(               \</span>
<span class="cp">      {__func__, __FILE__, static_cast&lt;uint32_t&gt;(__LINE__)}, msg)</span>

<span class="c1">// Private helper macro for workaround MSVC misexpansion of nested macro</span>
<span class="c1">// invocations involving __VA_ARGS__.  See</span>
<span class="c1">// https://stackoverflow.com/questions/5134523/msvc-doesnt-expand-va-args-correctly</span>
<span class="cp">#define C10_EXPAND_MSVC_WORKAROUND(x) x</span>

<span class="c1">// On nvcc, C10_UNLIKELY thwarts missing return statement analysis.  In cases</span>
<span class="c1">// where the unlikely expression may be a constant, use this macro to ensure</span>
<span class="c1">// return statement analysis keeps working (at the cost of not getting the</span>
<span class="c1">// likely/unlikely annotation on nvcc).</span>
<span class="c1">// https://github.com/pytorch/pytorch/issues/21418</span>
<span class="c1">//</span>
<span class="c1">// Currently, this is only used in the error reporting macros below.  If you</span>
<span class="c1">// want to use it more generally, move me to Macros.h</span>
<span class="c1">//</span>
<span class="c1">// TODO: Brian Vaughan observed that we might be able to get this to work on</span>
<span class="c1">// nvcc by writing some sort of C++ overload that distinguishes constexpr inputs</span>
<span class="c1">// from non-constexpr.  Since there isn&#39;t any evidence that losing C10_UNLIKELY</span>
<span class="c1">// in nvcc is causing us perf problems, this is not yet implemented, but this</span>
<span class="c1">// might be an interesting piece of C++ code for an intrepid bootcamper to</span>
<span class="c1">// write.</span>
<span class="cp">#if defined(__CUDACC__)</span>
<span class="cp">#define C10_UNLIKELY_OR_CONST(e) e</span>
<span class="cp">#else</span>
<span class="cp">#define C10_UNLIKELY_OR_CONST(e) C10_UNLIKELY(e)</span>
<span class="cp">#endif</span>

<span class="c1">// ----------------------------------------------------------------------------</span>
<span class="c1">// Error reporting macros</span>
<span class="c1">// ----------------------------------------------------------------------------</span>

<span class="cp">#ifdef STRIP_ERROR_MESSAGES</span>
<span class="cp">#define TORCH_RETHROW(e, ...) throw</span>
<span class="cp">#else</span>
<span class="cp">#define TORCH_RETHROW(e, ...)               \</span>
<span class="cp">  do {                                      \</span>
<span class="cp">    e.add_context(::c10::str(__VA_ARGS__)); \</span>
<span class="cp">    throw;                                  \</span>
<span class="cp">  } while (false)</span>
<span class="cp">#endif</span>

<span class="c1">// A utility macro to provide assert()-like functionality; that is, enforcement</span>
<span class="c1">// of internal invariants in code.  It supports an arbitrary number of extra</span>
<span class="c1">// arguments (evaluated only on failure), which will be printed in the assert</span>
<span class="c1">// failure message using operator&lt;&lt; (this is useful to print some variables</span>
<span class="c1">// which may be useful for debugging.)</span>
<span class="c1">//</span>
<span class="c1">// Usage:</span>
<span class="c1">//    TORCH_INTERNAL_ASSERT(should_be_true);</span>
<span class="c1">//    TORCH_INTERNAL_ASSERT(x == 0, &quot;x = &quot;, x);</span>
<span class="c1">//</span>
<span class="c1">// Assuming no bugs in PyTorch, the conditions tested by this macro should</span>
<span class="c1">// always be true; e.g., it should be possible to disable all of these</span>
<span class="c1">// conditions without changing observable user behavior.  If you would like to</span>
<span class="c1">// do error reporting for user input, please use TORCH_CHECK instead.</span>
<span class="c1">//</span>
<span class="c1">// NOTE: It is SAFE to use this macro in production code; on failure, this</span>
<span class="c1">// simply raises an exception, it does NOT unceremoniously quit the process</span>
<span class="c1">// (unlike assert()).</span>
<span class="c1">//</span>
<span class="cp">#ifdef STRIP_ERROR_MESSAGES</span>
<span class="cp">#define TORCH_INTERNAL_ASSERT(cond, ...)                              \</span>
<span class="cp">  if (C10_UNLIKELY_OR_CONST(!(cond))) {                               \</span>
<span class="cp">    ::c10::detail::torchCheckFail(                                    \</span>
<span class="cp">        __func__,                                                     \</span>
<span class="cp">        __FILE__,                                                     \</span>
<span class="cp">        static_cast&lt;uint32_t&gt;(__LINE__),                              \</span>
<span class="cp">        #cond &quot; INTERNAL ASSERT FAILED at &quot; C10_STRINGIZE(__FILE__)); \</span>
<span class="cp">  }</span>
<span class="cp">#else</span>
<span class="c1">// It would be nice if we could build a combined string literal out of</span>
<span class="c1">// the TORCH_INTERNAL_ASSERT prefix and a user-provided string literal</span>
<span class="c1">// as the first argument, but there doesn&#39;t seem to be any good way to</span>
<span class="c1">// do that while still supporting having a first argument that isn&#39;t a</span>
<span class="c1">// string literal.</span>
<span class="cp">#define TORCH_INTERNAL_ASSERT(cond, ...)                                         \</span>
<span class="cp">  if (C10_UNLIKELY_OR_CONST(!(cond))) {                                          \</span>
<span class="cp">    ::c10::detail::torchInternalAssertFail(                                      \</span>
<span class="cp">        __func__,                                                                \</span>
<span class="cp">        __FILE__,                                                                \</span>
<span class="cp">        static_cast&lt;uint32_t&gt;(__LINE__),                                         \</span>
<span class="cp">        #cond                                                                    \</span>
<span class="cp">        &quot; INTERNAL ASSERT FAILED at &quot; C10_STRINGIZE(__FILE__) &quot;:&quot; C10_STRINGIZE( \</span>
<span class="cp">            __LINE__) &quot;, please report a bug to PyTorch. &quot;,                      \</span>
<span class="cp">        c10::str(__VA_ARGS__));                                                  \</span>
<span class="cp">  }</span>
<span class="cp">#endif</span>

<span class="c1">// A utility macro to make it easier to test for error conditions from user</span>
<span class="c1">// input.  Like TORCH_INTERNAL_ASSERT, it supports an arbitrary number of extra</span>
<span class="c1">// arguments (evaluated only on failure), which will be printed in the error</span>
<span class="c1">// message using operator&lt;&lt; (e.g., you can pass any object which has</span>
<span class="c1">// operator&lt;&lt; defined.  Most objects in PyTorch have these definitions!)</span>
<span class="c1">//</span>
<span class="c1">// Usage:</span>
<span class="c1">//    TORCH_CHECK(should_be_true); // A default error message will be provided</span>
<span class="c1">//                                 // in this case; but we recommend writing an</span>
<span class="c1">//                                 // explicit error message, as it is more</span>
<span class="c1">//                                 // user friendly.</span>
<span class="c1">//    TORCH_CHECK(x == 0, &quot;Expected x to be 0, but got &quot;, x);</span>
<span class="c1">//</span>
<span class="c1">// On failure, this macro will raise an exception.  If this exception propagates</span>
<span class="c1">// to Python, it will convert into a Python RuntimeError.</span>
<span class="c1">//</span>
<span class="c1">// NOTE: It is SAFE to use this macro in production code; on failure, this</span>
<span class="c1">// simply raises an exception, it does NOT unceremoniously quit the process</span>
<span class="c1">// (unlike CHECK() from glog.)</span>
<span class="c1">//</span>
<span class="cp">#define TORCH_CHECK_WITH(error_t, cond, ...) \</span>
<span class="cp">  TORCH_CHECK_WITH_MSG(error_t, cond, &quot;&quot;, __VA_ARGS__)</span>

<span class="cp">#ifdef STRIP_ERROR_MESSAGES</span>
<span class="cp">#define TORCH_CHECK_MSG(cond, type, ...) \</span>
<span class="cp">  (#cond #type &quot; CHECK FAILED at &quot; C10_STRINGIZE(__FILE__))</span>
<span class="cp">#define TORCH_CHECK_WITH_MSG(error_t, cond, type, ...)                \</span>
<span class="cp">  if (C10_UNLIKELY_OR_CONST(!(cond))) {                               \</span>
<span class="cp">    C10_THROW_ERROR(Error, TORCH_CHECK_MSG(cond, type, __VA_ARGS__)); \</span>
<span class="cp">  }</span>
<span class="cp">#else</span>
<span class="k">namespace</span><span class="w"> </span><span class="nn">c10</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="k">namespace</span><span class="w"> </span><span class="nn">detail</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="k">template</span><span class="w"> </span><span class="o">&lt;</span><span class="k">typename</span><span class="p">...</span><span class="w"> </span><span class="n">Args</span><span class="o">&gt;</span><span class="w"></span>
<span class="k">decltype</span><span class="p">(</span><span class="k">auto</span><span class="p">)</span><span class="w"> </span><span class="n">torchCheckMsgImpl</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="cm">/*msg*/</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">Args</span><span class="o">&amp;</span><span class="p">...</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="o">::</span><span class="n">c10</span><span class="o">::</span><span class="n">str</span><span class="p">(</span><span class="n">args</span><span class="p">...);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
<span class="kr">inline</span><span class="w"> </span><span class="n">C10_API</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">torchCheckMsgImpl</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">msg</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">msg</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
<span class="c1">// If there is just 1 user-provided C-string argument, use it.</span>
<span class="kr">inline</span><span class="w"> </span><span class="n">C10_API</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">torchCheckMsgImpl</span><span class="p">(</span><span class="w"></span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="cm">/*msg*/</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">args</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"> </span><span class="c1">// namespace detail</span>
<span class="p">}</span><span class="w"> </span><span class="c1">// namespace c10</span>

<span class="cp">#define TORCH_CHECK_MSG(cond, type, ...)                   \</span>
<span class="cp">  (::c10::detail::torchCheckMsgImpl(                       \</span>
<span class="cp">      &quot;Expected &quot; #cond                                    \</span>
<span class="cp">      &quot; to be true, but got false.  &quot;                      \</span>
<span class="cp">      &quot;(Could this error message be improved?  If so, &quot;    \</span>
<span class="cp">      &quot;please report an enhancement request to PyTorch.)&quot;, \</span>
<span class="cp">      ##__VA_ARGS__))</span>
<span class="cp">#define TORCH_CHECK_WITH_MSG(error_t, cond, type, ...)                  \</span>
<span class="cp">  if (C10_UNLIKELY_OR_CONST(!(cond))) {                                 \</span>
<span class="cp">    C10_THROW_ERROR(error_t, TORCH_CHECK_MSG(cond, type, __VA_ARGS__)); \</span>
<span class="cp">  }</span>
<span class="cp">#endif</span>

<span class="k">namespace</span><span class="w"> </span><span class="nn">c10</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="k">namespace</span><span class="w"> </span><span class="nn">detail</span><span class="w"> </span><span class="p">{</span><span class="w"></span>

<span class="p">[[</span><span class="n">noreturn</span><span class="p">]]</span><span class="w"> </span><span class="n">C10_API</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="n">torchCheckFail</span><span class="p">(</span><span class="w"></span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">func</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">file</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">line</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">msg</span><span class="p">);</span><span class="w"></span>
<span class="p">[[</span><span class="n">noreturn</span><span class="p">]]</span><span class="w"> </span><span class="n">C10_API</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="n">torchCheckFail</span><span class="p">(</span><span class="w"></span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">func</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">file</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">line</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">msg</span><span class="p">);</span><span class="w"></span>

<span class="c1">// The c10::str() call that creates userMsg can have 1 of 3 return</span>
<span class="c1">// types depending on the number and types of arguments passed to</span>
<span class="c1">// TORCH_INTERNAL_ASSERT.  0 arguments will get a</span>
<span class="c1">// CompileTimeEmptyString, 1 const char * will be passed straight</span>
<span class="c1">// through, and anything else will get converted to std::string.</span>
<span class="p">[[</span><span class="n">noreturn</span><span class="p">]]</span><span class="w"> </span><span class="n">C10_API</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="n">torchInternalAssertFail</span><span class="p">(</span><span class="w"></span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">func</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">file</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">line</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">condMsg</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">userMsg</span><span class="p">);</span><span class="w"></span>
<span class="p">[[</span><span class="n">noreturn</span><span class="p">]]</span><span class="w"> </span><span class="kr">inline</span><span class="w"> </span><span class="n">C10_API</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="n">torchInternalAssertFail</span><span class="p">(</span><span class="w"></span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">func</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">file</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">line</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">condMsg</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="o">::</span><span class="n">c10</span><span class="o">::</span><span class="n">detail</span><span class="o">::</span><span class="n">CompileTimeEmptyString</span><span class="w"> </span><span class="cm">/*userMsg*/</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="n">torchCheckFail</span><span class="p">(</span><span class="n">func</span><span class="p">,</span><span class="w"> </span><span class="n">file</span><span class="p">,</span><span class="w"> </span><span class="n">line</span><span class="p">,</span><span class="w"> </span><span class="n">condMsg</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
<span class="p">[[</span><span class="n">noreturn</span><span class="p">]]</span><span class="w"> </span><span class="n">C10_API</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="n">torchInternalAssertFail</span><span class="p">(</span><span class="w"></span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">func</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">file</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">line</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">condMsg</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">userMsg</span><span class="p">);</span><span class="w"></span>

<span class="p">}</span><span class="w"> </span><span class="c1">// namespace detail</span>
<span class="p">}</span><span class="w"> </span><span class="c1">// namespace c10</span>

<span class="cp">#ifdef STRIP_ERROR_MESSAGES</span>
<span class="cp">#define TORCH_CHECK(cond, ...)                   \</span>
<span class="cp">  if (C10_UNLIKELY_OR_CONST(!(cond))) {          \</span>
<span class="cp">    ::c10::detail::torchCheckFail(               \</span>
<span class="cp">        __func__,                                \</span>
<span class="cp">        __FILE__,                                \</span>
<span class="cp">        static_cast&lt;uint32_t&gt;(__LINE__),         \</span>
<span class="cp">        TORCH_CHECK_MSG(cond, &quot;&quot;, __VA_ARGS__)); \</span>
<span class="cp">  }</span>
<span class="cp">#else</span>
<span class="cp">#define TORCH_CHECK(cond, ...)                     \</span>
<span class="cp">  if (C10_UNLIKELY_OR_CONST(!(cond))) {            \</span>
<span class="cp">    ::c10::detail::torchCheckFail(                 \</span>
<span class="cp">        __func__,                                  \</span>
<span class="cp">        __FILE__,                                  \</span>
<span class="cp">        static_cast&lt;uint32_t&gt;(__LINE__),           \</span>
<span class="cp">        TORCH_CHECK_MSG(cond, &quot;&quot;, ##__VA_ARGS__)); \</span>
<span class="cp">  }</span>
<span class="cp">#endif</span>

<span class="c1">// An utility macro that does what `TORCH_CHECK` does if compiled in the host</span>
<span class="c1">// code, otherwise does nothing. Supposed to be used in the code shared between</span>
<span class="c1">// host and device code as an alternative for `TORCH_CHECK`.</span>
<span class="cp">#if defined(__CUDACC__) || defined(__HIPCC__)</span>
<span class="cp">#define TORCH_CHECK_IF_NOT_ON_CUDA(cond, ...)</span>
<span class="cp">#else</span>
<span class="cp">#define TORCH_CHECK_IF_NOT_ON_CUDA(cond, ...) TORCH_CHECK(cond, ##__VA_ARGS__)</span>
<span class="cp">#endif</span>

<span class="c1">// Debug only version of TORCH_INTERNAL_ASSERT. This macro only checks in debug</span>
<span class="c1">// build, and does nothing in release build.  It is appropriate to use</span>
<span class="c1">// in situations where you want to add an assert to a hotpath, but it is</span>
<span class="c1">// too expensive to run this assert on production builds.</span>
<span class="cp">#ifdef NDEBUG</span>
<span class="c1">// Optimized version - generates no code.</span>
<span class="cp">#define TORCH_INTERNAL_ASSERT_DEBUG_ONLY(...) \</span>
<span class="cp">  while (false)                               \</span>
<span class="cp">  C10_EXPAND_MSVC_WORKAROUND(TORCH_INTERNAL_ASSERT(__VA_ARGS__))</span>
<span class="cp">#else</span>
<span class="cp">#define TORCH_INTERNAL_ASSERT_DEBUG_ONLY(...) \</span>
<span class="cp">  C10_EXPAND_MSVC_WORKAROUND(TORCH_INTERNAL_ASSERT(__VA_ARGS__))</span>
<span class="cp">#endif</span>

<span class="c1">// TODO: We&#39;re going to get a lot of similar looking string literals</span>
<span class="c1">// this way; check if this actually affects binary size.</span>

<span class="c1">// Like TORCH_CHECK, but raises LinAlgError instead of Error.</span>
<span class="cp">#define TORCH_CHECK_LINALG(cond, ...) \</span>
<span class="cp">  TORCH_CHECK_WITH_MSG(LinAlgError, cond, &quot;LINALG&quot;, __VA_ARGS__)</span>

<span class="c1">// Like TORCH_CHECK, but raises IndexErrors instead of Errors.</span>
<span class="cp">#define TORCH_CHECK_INDEX(cond, ...) \</span>
<span class="cp">  TORCH_CHECK_WITH_MSG(IndexError, cond, &quot;INDEX&quot;, __VA_ARGS__)</span>

<span class="c1">// Like TORCH_CHECK, but raises ValueErrors instead of Errors.</span>
<span class="cp">#define TORCH_CHECK_VALUE(cond, ...) \</span>
<span class="cp">  TORCH_CHECK_WITH_MSG(ValueError, cond, &quot;VALUE&quot;, __VA_ARGS__)</span>

<span class="c1">// Like TORCH_CHECK, but raises TypeErrors instead of Errors.</span>
<span class="cp">#define TORCH_CHECK_TYPE(cond, ...) \</span>
<span class="cp">  TORCH_CHECK_WITH_MSG(TypeError, cond, &quot;TYPE&quot;, __VA_ARGS__)</span>

<span class="c1">// Like TORCH_CHECK, but raises NotImplementedErrors instead of Errors.</span>
<span class="cp">#define TORCH_CHECK_NOT_IMPLEMENTED(cond, ...) \</span>
<span class="cp">  TORCH_CHECK_WITH_MSG(NotImplementedError, cond, &quot;TYPE&quot;, __VA_ARGS__)</span>

<span class="c1">// Report a warning to the user.  Accepts an arbitrary number of extra</span>
<span class="c1">// arguments which are concatenated into the warning message using operator&lt;&lt;</span>
<span class="c1">//</span>
<span class="cp">#ifdef STRIP_ERROR_MESSAGES</span>
<span class="cp">#define TORCH_WARN(...)                                      \</span>
<span class="cp">  ::c10::Warning::warn(                                      \</span>
<span class="cp">      {__func__, __FILE__, static_cast&lt;uint32_t&gt;(__LINE__)}, \</span>
<span class="cp">      ::c10::detail::CompileTimeEmptyString{},               \</span>
<span class="cp">      false)</span>
<span class="cp">#else</span>
<span class="cp">#define TORCH_WARN(...)                                      \</span>
<span class="cp">  ::c10::Warning::warn(                                      \</span>
<span class="cp">      {__func__, __FILE__, static_cast&lt;uint32_t&gt;(__LINE__)}, \</span>
<span class="cp">      ::c10::str(__VA_ARGS__),                               \</span>
<span class="cp">      false)</span>
<span class="cp">#endif</span>

<span class="c1">// Report a warning to the user only once.  Accepts an arbitrary number of extra</span>
<span class="c1">// arguments which are concatenated into the warning message using operator&lt;&lt;</span>
<span class="c1">//</span>
<span class="cp">#ifdef STRIP_ERROR_MESSAGES</span>
<span class="cp">#define _TORCH_WARN_ONCE(...)                                             \</span>
<span class="cp">  C10_UNUSED static const auto C10_ANONYMOUS_VARIABLE(torch_warn_once_) = \</span>
<span class="cp">      [&amp;] {                                                               \</span>
<span class="cp">        ::c10::Warning::warn(                                             \</span>
<span class="cp">            {__func__, __FILE__, static_cast&lt;uint32_t&gt;(__LINE__)},        \</span>
<span class="cp">            ::c10::detail::CompileTimeEmptyString{},                      \</span>
<span class="cp">            false);                                                       \</span>
<span class="cp">        return true;                                                      \</span>
<span class="cp">      }()</span>
<span class="cp">#else</span>
<span class="cp">#define _TORCH_WARN_ONCE(...)                                             \</span>
<span class="cp">  C10_UNUSED static const auto C10_ANONYMOUS_VARIABLE(torch_warn_once_) = \</span>
<span class="cp">      [&amp;] {                                                               \</span>
<span class="cp">        ::c10::Warning::warn(                                             \</span>
<span class="cp">            {__func__, __FILE__, static_cast&lt;uint32_t&gt;(__LINE__)},        \</span>
<span class="cp">            ::c10::str(__VA_ARGS__),                                      \</span>
<span class="cp">            false);                                                       \</span>
<span class="cp">        return true;                                                      \</span>
<span class="cp">      }()</span>
<span class="cp">#endif</span>

<span class="cp">#define TORCH_WARN_ONCE(...)              \</span>
<span class="cp">  if (::c10::Warning::get_warnAlways()) { \</span>
<span class="cp">    TORCH_WARN(__VA_ARGS__);              \</span>
<span class="cp">  } else {                                \</span>
<span class="cp">    _TORCH_WARN_ONCE(__VA_ARGS__);        \</span>
<span class="cp">  }</span>

<span class="c1">// Report an error with a specific argument</span>
<span class="c1">// NOTE: using the argument name in TORCH_CHECK&#39;s message is preferred</span>
<span class="cp">#define TORCH_CHECK_ARG(cond, argN, ...) \</span>
<span class="cp">  TORCH_CHECK(cond, &quot;invalid argument &quot;, argN, &quot;: &quot;, __VA_ARGS__)</span>

<span class="c1">// ----------------------------------------------------------------------------</span>
<span class="c1">// Deprecated macros</span>
<span class="c1">// ----------------------------------------------------------------------------</span>

<span class="k">namespace</span><span class="w"> </span><span class="nn">c10</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="k">namespace</span><span class="w"> </span><span class="nn">detail</span><span class="w"> </span><span class="p">{</span><span class="w"></span>

<span class="cm">/*</span>
<span class="cm">// Deprecation disabled until we fix sites in our codebase</span>
<span class="cm">C10_DEPRECATED_MESSAGE(&quot;AT_ERROR(msg) is deprecated, use TORCH_CHECK(false, msg)</span>
<span class="cm">instead.&quot;)</span>
<span class="cm">*/</span><span class="w"></span>
<span class="kr">inline</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">deprecated_AT_ERROR</span><span class="p">()</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>

<span class="cm">/*</span>
<span class="cm">// Deprecation disabled until we fix sites in our codebase</span>
<span class="cm">C10_DEPRECATED_MESSAGE(&quot;AT_ASSERT is deprecated, if you mean to indicate an</span>
<span class="cm">internal invariant failure, use &quot; \</span>
<span class="cm">                       &quot;TORCH_INTERNAL_ASSERT instead; if you mean to do user</span>
<span class="cm">error checking, use &quot; \ &quot;TORCH_CHECK.  See</span>
<span class="cm">https://github.com/pytorch/pytorch/issues/20287 for more details.&quot;)</span>
<span class="cm">*/</span><span class="w"></span>
<span class="kr">inline</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">deprecated_AT_ASSERT</span><span class="p">()</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>

<span class="cm">/*</span>
<span class="cm">// Deprecation disabled until we fix sites in our codebase</span>
<span class="cm">C10_DEPRECATED_MESSAGE(&quot;AT_ASSERTM is deprecated, if you mean to indicate an</span>
<span class="cm">internal invariant failure, use &quot; \</span>
<span class="cm">                       &quot;TORCH_INTERNAL_ASSERT instead; if you mean to do user</span>
<span class="cm">error checking, use &quot; \ &quot;TORCH_CHECK.  See</span>
<span class="cm">https://github.com/pytorch/pytorch/issues/20287 for more details.&quot;)</span>
<span class="cm">*/</span><span class="w"></span>
<span class="kr">inline</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">deprecated_AT_ASSERTM</span><span class="p">()</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>

<span class="p">}</span><span class="w"> </span><span class="c1">// namespace detail</span>
<span class="p">}</span><span class="w"> </span><span class="c1">// namespace c10</span>

<span class="c1">// Deprecated alias; this alias was deprecated because people kept mistakenly</span>
<span class="c1">// using it for user error checking.  Use TORCH_INTERNAL_ASSERT or TORCH_CHECK</span>
<span class="c1">// instead. See https://github.com/pytorch/pytorch/issues/20287 for more</span>
<span class="c1">// details.</span>
<span class="cp">#define AT_ASSERT(...)                                              \</span>
<span class="cp">  do {                                                              \</span>
<span class="cp">    ::c10::detail::deprecated_AT_ASSERT();                          \</span>
<span class="cp">    C10_EXPAND_MSVC_WORKAROUND(TORCH_INTERNAL_ASSERT(__VA_ARGS__)); \</span>
<span class="cp">  } while (false)</span>

<span class="c1">// Deprecated alias, like AT_ASSERT.  The new TORCH_INTERNAL_ASSERT macro</span>
<span class="c1">// supports both 0-ary and variadic calls, so having a separate</span>
<span class="c1">// message-accepting macro is not necessary.</span>
<span class="c1">//</span>
<span class="c1">// NB: we MUST include cond explicitly here, as MSVC will miscompile the macro</span>
<span class="c1">// expansion, shunting all of __VA_ARGS__ to cond.  An alternate workaround</span>
<span class="c1">// can be seen at</span>
<span class="c1">// https://stackoverflow.com/questions/5134523/msvc-doesnt-expand-va-args-correctly</span>
<span class="cp">#define AT_ASSERTM(cond, ...)                                             \</span>
<span class="cp">  do {                                                                    \</span>
<span class="cp">    ::c10::detail::deprecated_AT_ASSERTM();                               \</span>
<span class="cp">    C10_EXPAND_MSVC_WORKAROUND(TORCH_INTERNAL_ASSERT(cond, __VA_ARGS__)); \</span>
<span class="cp">  } while (false)</span>

<span class="c1">// Deprecated alias; this alias was deprecated because it represents extra API</span>
<span class="c1">// surface that makes it hard for people to understand what macro to use.</span>
<span class="c1">// Use TORCH_CHECK(false, ...) or TORCH_INTERNAL_ASSERT(false, ...) to</span>
<span class="c1">// unconditionally fail at a line of code.</span>
<span class="cp">#define AT_ERROR(...)                                                        \</span>
<span class="cp">  do {                                                                       \</span>
<span class="cp">    ::c10::detail::deprecated_AT_ERROR();                                    \</span>
<span class="cp">    C10_EXPAND_MSVC_WORKAROUND(TORCH_CHECK(false, ::c10::str(__VA_ARGS__))); \</span>
<span class="cp">  } while (false)</span>

<span class="cp">#endif </span><span class="c1">// C10_UTIL_EXCEPTION_H_</span>
</pre></div>
</div>
</div>


             </article>
             
            </div>
            <footer>
  

  

    <hr>

  

  <div role="contentinfo">
    <p>
        &copy; Copyright 2022, PyTorch Contributors.

    </p>
  </div>
    
      <div>
        Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
      </div>
     

</footer>

          </div>
        </div>

        <div class="pytorch-content-right" id="pytorch-content-right">
          <div class="pytorch-right-menu" id="pytorch-right-menu">
            <div class="pytorch-side-scroll" id="pytorch-side-scroll-right">
              <ul>
<li><a class="reference internal" href="#">Program Listing for File Exception.h</a></li>
</ul>

            </div>
          </div>
        </div>
      </section>
    </div>

  


  

     
       <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
         <script src="../_static/jquery.js"></script>
         <script src="../_static/underscore.js"></script>
         <script src="../_static/doctools.js"></script>
         <script src="../_static/language_data.js"></script>
         <script src="../_static/collapsible-lists/js/CollapsibleLists.compressed.js"></script>
         <script src="../_static/collapsible-lists/js/apply-collapsible-lists.js"></script>
     

  

  <script type="text/javascript" src="../_static/js/vendor/popper.min.js"></script>
  <script type="text/javascript" src="../_static/js/vendor/bootstrap.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/list.js/1.5.0/list.min.js"></script>
  <script type="text/javascript" src="../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

  <!-- Begin Footer -->

  <div class="container-fluid docs-tutorials-resources" id="docs-tutorials-resources">
    <div class="container">
      <div class="row">
        <div class="col-md-4 text-center">
          <h2>Docs</h2>
          <p>Access comprehensive developer documentation for PyTorch</p>
          <a class="with-right-arrow" href="https://pytorch.org/docs/stable/index.html">View Docs</a>
        </div>

        <div class="col-md-4 text-center">
          <h2>Tutorials</h2>
          <p>Get in-depth tutorials for beginners and advanced developers</p>
          <a class="with-right-arrow" href="https://pytorch.org/tutorials">View Tutorials</a>
        </div>

        <div class="col-md-4 text-center">
          <h2>Resources</h2>
          <p>Find development resources and get your questions answered</p>
          <a class="with-right-arrow" href="https://pytorch.org/resources">View Resources</a>
        </div>
      </div>
    </div>
  </div>

  <footer class="site-footer">
    <div class="container footer-container">
      <div class="footer-logo-wrapper">
        <a href="https://pytorch.org/" class="footer-logo"></a>
      </div>

      <div class="footer-links-wrapper">
        <div class="footer-links-col">
          <ul>
            <li class="list-title"><a href="https://pytorch.org/">PyTorch</a></li>
            <li><a href="https://pytorch.org/get-started">Get Started</a></li>
            <li><a href="https://pytorch.org/features">Features</a></li>
            <li><a href="https://pytorch.org/ecosystem">Ecosystem</a></li>
            <li><a href="https://pytorch.org/blog/">Blog</a></li>
            <li><a href="https://github.com/pytorch/pytorch/blob/master/CONTRIBUTING.md">Contributing</a></li>
          </ul>
        </div>

        <div class="footer-links-col">
          <ul>
            <li class="list-title"><a href="https://pytorch.org/resources">Resources</a></li>
            <li><a href="https://pytorch.org/tutorials">Tutorials</a></li>
            <li><a href="https://pytorch.org/docs/stable/index.html">Docs</a></li>
            <li><a href="https://discuss.pytorch.org" target="_blank">Discuss</a></li>
            <li><a href="https://github.com/pytorch/pytorch/issues" target="_blank">Github Issues</a></li>
            <li><a href="https://pytorch.org/assets/brand-guidelines/PyTorch-Brand-Guidelines.pdf" target="_blank">Brand Guidelines</a></li>
          </ul>
        </div>

        <div class="footer-links-col">
          <ul>
            <li class="list-title">Stay up to date</li>
            <li><a href="https://www.facebook.com/pytorch" target="_blank">Facebook</a></li>
            <li><a href="https://twitter.com/pytorch" target="_blank">Twitter</a></li>
            <li><a href="https://www.youtube.com/pytorch" target="_blank">YouTube</a></li>
            <li><a href="https://www.linkedin.com/company/pytorch" target="_blank">LinkedIn</a></li>
          </ul>  
          </div>

        <div class="footer-links-col">
          <ul>
            <li class="list-title">PyTorch Podcasts</li>
            <li><a href="https://open.spotify.com/show/6UzHKeiy368jKfQMKKvJY5" target="_blank">Spotify</a></li>
            <li><a href="https://podcasts.apple.com/us/podcast/pytorch-developer-podcast/id1566080008" target="_blank">Apple</a></li>
            <li><a href="https://www.google.com/podcasts?feed=aHR0cHM6Ly9mZWVkcy5zaW1wbGVjYXN0LmNvbS9PQjVGa0lsOA%3D%3D" target="_blank">Google</a></li>
            <li><a href="https://music.amazon.com/podcasts/7a4e6f0e-26c2-49e9-a478-41bd244197d0/PyTorch-Developer-Podcast?" target="_blank">Amazon</a></li>
          </ul>
         </div>
        </div>
        
        <div class="privacy-policy">
          <ul>
            <li class="privacy-policy-links"><a href="https://www.linuxfoundation.org/terms/" target="_blank">Terms</a></li>
            <li class="privacy-policy-links">|</li>
            <li class="privacy-policy-links"><a href="https://www.linuxfoundation.org/privacy-policy/" target="_blank">Privacy</a></li>
          </ul>
        </div>
        <div class="copyright">
        <p>Â© Copyright The Linux Foundation. The PyTorch Foundation is a project of The Linux Foundation.
          For web site terms of use, trademark policy and other policies applicable to The PyTorch Foundation please see
          <a href="www.linuxfoundation.org/policies/">www.linuxfoundation.org/policies/</a>. The PyTorch Foundation supports the PyTorch open source
          project, which has been established as PyTorch Project a Series of LF Projects, LLC. For policies applicable to the PyTorch Project a Series of LF Projects, LLC,
          please see <a href="www.lfprojects.org/policies/">www.lfprojects.org/policies/</a>.</p>
      </div>
     </div>

  </footer>

  <div class="cookie-banner-wrapper">
  <div class="container">
    <p class="gdpr-notice">To analyze traffic and optimize your experience, we serve cookies on this site. By clicking or navigating, you agree to allow our usage of cookies. As the current maintainers of this site, Facebookâ€™s Cookies Policy applies. Learn more, including about available controls: <a href="https://www.facebook.com/policies/cookies/">Cookies Policy</a>.</p>
    <img class="close-button" src="../_static/images/pytorch-x.svg">
  </div>
</div>

  <!-- End Footer -->

  <!-- Begin Mobile Menu -->

  <div class="mobile-main-menu">
    <div class="container-fluid">
      <div class="container">
        <div class="mobile-main-menu-header-container">
          <a class="header-logo" href="https://pytorch.org/" aria-label="PyTorch"></a>
          <a class="main-menu-close-button" href="#" data-behavior="close-mobile-menu"></a>
        </div>
      </div>
    </div>

    <div class="mobile-main-menu-links-container">
      <div class="main-menu">
        <ul>
          <li>
            <a href="https://pytorch.org/get-started">Get Started</a>
          </li>

          <li>
            <a href="https://pytorch.org/ecosystem">Ecosystem</a>
          </li>
            
          <li>
            <a href="https://pytorch.org/mobile">Mobile</a>
          </li>

          <li>
            <a href="https://pytorch.org/blog/">Blog</a>
          </li>

          <li>
            <a href="https://pytorch.org/tutorials">Tutorials</a>
          </li>

          <li class="resources-mobile-menu-title" class="active">
            Docs
          </li>

          <ul class="resources-mobile-menu-items">
            <li>
              <a href="https://pytorch.org/docs/stable/index.html">PyTorch</a>
            </li>

            <li>
              <a href="https://pytorch.org/audio/stable/index.html">torchaudio</a>
            </li>

            <li>
              <a href="https://pytorch.org/text/stable/index.html">torchtext</a>
            </li>

            <li>
              <a href="https://pytorch.org/vision/stable/index.html">torchvision</a>
            </li>

            <li>
              <a href="https://pytorch.org/torcharrow">torcharrow</a>
            </li>

            <li>
              <a href="https://pytorch.org/data">TorchData</a>
            </li>

            <li>
              <a href="https://pytorch.org/torchrec">TorchRec</a>
            </li>

            <li>
              <a href="https://pytorch.org/serve/">TorchServe</a>
            </li>

            <li>
              <a href="https://pytorch.org/torchx/">TorchX</a>
            </li>

            <li>
              <a href="https://pytorch.org/xla">PyTorch on XLA Devices</a>
            </li>
          </ul>

          <li class="resources-mobile-menu-title">
            Resources
          </li>
            
           <ul class="resources-mobile-menu-items">

            <li>
              <a href="https://pytorch.org/features">About</a>
            </li>

            <li>
              <a href="https://pytorch.org/foundation">PyTorch Foundation</a>
            </li>

            <li>
              <a href="https://pytorch.org/#community-module">Community</a>
            </li>

            <li>
              <a href="https://pytorch.org/community-stories">Community Stories</a>
            </li>

            <li>
              <a href="https://pytorch.org/resources">Developer Resources</a>
            </li>

            <li>
              <a href="https://pytorch.org/events">Events</a>
            </li>

            <li>
              <a href="https://discuss.pytorch.org/">Forums</a>
            </li>

            <li>
              <a href="https://pytorch.org/hub">Models (Beta)</a>
            </li>
          </ul>

          <li>
            <a href="https://github.com/pytorch/pytorch">Github</a>
          </li>
        </ul>
      </div>
    </div>
  </div>

  <!-- End Mobile Menu -->

  <script type="text/javascript" src="../_static/js/vendor/anchor.min.js"></script>

  <script type="text/javascript">
    $(document).ready(function() {
      mobileMenu.bind();
      mobileTOC.bind();
      pytorchAnchors.bind();
      sideMenus.bind();
      scrollToAnchor.bind();
      highlightNavigation.bind();
      mainMenuDropdown.bind();
      filterTags.bind();

      // Add class to links that have code blocks, since we cannot create links in code blocks
      $("article.pytorch-article a span.pre").each(function(e) {
        $(this).closest("a").addClass("has-code");
      });
    })
  </script>
</body>
</html>